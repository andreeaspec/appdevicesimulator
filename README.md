# Device Simulator

This application is a simple device simulator. It creates a REST API using FastAPI for adding devices,
getting the device details, deleting devices, and sending commands to specific devices.
Commands are interpreted and the devices status is updated according to the commands params.

## Tech stack
* Python 3.11 running on Windows 11
* Docker Desktop - used to run the Redis container
* Redis 7
* Pycharm as the IDE
* pytest using asyncio
* FastAPI for the REST API
* OpenAPI / Swagger automatically generated by FastAPI

## How to run it
Start the Redis container using docker-compose.
Port 6379 must be available for Redis to start listening
```commandline
docker-compose up --build
```

Start the FastAPI REST API server using the uvicorn server locally on port 8080:
```commandline
uvicorn main:app --host 0.0.0.0 --port 8080
```

Acces the Swagger UI by pointing your browser to:
```
http://localhost:8080/docs
```

See the OpenAPI schema for the REST API by pointing your browser to:
```
http://localhost:8080/openapi.json
```

Run the pytest test suite:
```commandline
pytest -v
```

## Sample output from the previous commands
```commandline
PS C:\Users\Andreea\PycharmProjects\appdevicesimulator> docker-compose up --build
[+] Running 1/1
 ✔ redis Pulled                                                                                                                                                                                          1.4s 
[+] Running 2/2
 ✔ Network appdevicesimulator_default  Created                                                                                                                                                           0.1s 
redis  | 1:M 23 May 2025 20:14:46.108 * Running mode=standalone, port=6379.
redis  | 1:M 23 May 2025 20:14:46.109 * Server initialized
redis  | 1:M 23 May 2025 20:14:46.109 * Ready to accept connections tcp
redis  | 1:M 23 May 2025 21:14:47.034 * 1 changes in 3600 seconds. Saving...
redis  | 1:M 23 May 2025 21:14:47.038 * Background saving started by pid 23
redis  | 23:C 23 May 2025 21:14:47.056 * DB saved on disk
redis  | 23:C 23 May 2025 21:14:47.057 * Fork CoW for RDB: current 0 MB, peak 0 MB, average 0 MB
redis  | 24:C 23 May 2025 21:35:27.721 * DB saved on disk
redis  | 24:C 23 May 2025 21:35:27.722 * Fork CoW for RDB: current 0 MB, peak 0 MB, average 0 MB

PS C:\Users\Andreea\PycharmProjects\appdevicesimulator> uvicorn main:app --host 0.0.0.0 --port 8080
INFO:     Started server process [18020]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://0.0.0.0:8080 (Press CTRL+C to quit)
INFO:     127.0.0.1:61569 - "GET /docs HTTP/1.1" 200 OK
INFO:     127.0.0.1:61569 - "GET /openapi.json HTTP/1.1" 200 OK

# Running the test suite
PS C:\Users\Andreea\PycharmProjects\appdevicesimulator> pytest -v
============================================================================================ test session starts ============================================================================================
platform win32 -- Python 3.10.4, pytest-8.3.5, pluggy-1.5.0 -- C:\Python310\python.exe
cachedir: .pytest_cache
metadata: {'Python': '3.10.4', 'Platform': 'Windows-10-10.0.26100-SP0', 'Packages': {'pytest': '8.3.5', 'pluggy': '1.5.0'}, 'Plugins': {'anyio': '4.9.0', 'asyncio': '0.26.0', 'html': '4.1.1', 'metadata': '3.1.1'}, 'JAVA_HOME': 'C:\\Program Files\\Java\\jdk-11.0.15\\'}
rootdir: C:\Users\Andreea\PycharmProjects\appdevicesimulator
plugins: anyio-4.9.0, asyncio-0.26.0, html-4.1.1, metadata-3.1.1
asyncio: mode=strict, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collected 15 items                                                                                                                                                                                            

test_endpoints.py::test_get_devices PASSED                                                                                                                                                             [  6%]
test_endpoints.py::test_get_device PASSED                                                                                                                                                              [ 13%] 
test_endpoints.py::test_get_device_details PASSED                                                                                                                                                      [ 20%]
test_endpoints.py::test_get_devices_invalid[Andreea] PASSED                                                                                                                                            [ 26%] 
test_endpoints.py::test_get_devices_invalid[] PASSED                                                                                                                                                   [ 33%]
test_endpoints.py::test_get_devices_invalid[2s$#%#] PASSED                                                                                                                                             [ 40%]
test_endpoints.py::test_get_devices_invalid[AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA] PASSED                                               [ 46%] 
test_endpoints.py::test_get_devices_invalid[DEVICE1] PASSED                                                                                                                                            [ 53%]
test_endpoints.py::test_get_devices_valid[device1] PASSED                                                                                                                                              [ 60%]
test_endpoints.py::test_get_devices_valid[device2] PASSED                                                                                                                                              [ 66%]
test_endpoints.py::test_get_devices_valid[device3] PASSED                                                                                                                                              [ 73%]
test_endpoints.py::test_delete_device PASSED                                                                                                                                                           [ 80%]
test_endpoints.py::test_delete_device_non_existent PASSED                                                                                                                                              [ 86%]
test_endpoints.py::test_send_command PASSED                                                                                                                                                            [ 93%]
test_endpoints.py::test_openapi_endpoints_present PASSED                                                                                                                                               [100%]

============================================================================================ 15 passed in 0.27s =============================================================================================
```